<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>漢方AI問診 v11（初心者モード付き）</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  /* Light theme: 高コントラストで見やすく */
  body{background:#f7f9fc;color:#0b1220;}
  .navbar{background:#ffffff;border-bottom:1px solid #e6ecf5;}
  .card{background:#ffffff;border:1px solid #e6ecf5;}
  .form-control,.form-select,.form-check-input{
    background:#ffffff;color:#0b1220;border-color:#c9d4ea;
  }
  .form-control::placeholder{color:#9aa7bd;}
  .form-control:focus,.form-select:focus{
    border-color:#5aa0ff;box-shadow:0 0 0 .2rem rgba(90,160,255,.15)
  }
  .hint{color:#6b7a99}
  a,.btn-link{color:#0b6bff}
  .badge{font-weight:500}
  .btn-primary{background:#0b6bff;border-color:#0b6bff}
  .btn-primary:hover{background:#095ad6;border-color:#095ad6}
</style>
</head>
<body>
<nav class="navbar navbar-dark px-3">
  <span class="navbar-brand fw-bold">漢方AI問診 v11</span>
  <span class="small text-secondary">初心者モード（症状チェック→自動反映）付き</span>
</nav>

<div class="container my-4">
  <form action="/submit" method="post" enctype="multipart/form-data">

    <!-- 基本情報 -->
    <div class="card mb-4">
      <div class="card-header fw-bold">基本情報</div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-6 col-md-3">
            <label class="form-label">氏名</label>
            <input type="text" name="name" class="form-control" placeholder="山田 花子">
          </div>
          <div class="col-sm-6 col-md-2">
            <label class="form-label">年齢</label>
            <input type="number" name="age" class="form-control" min="0" max="120" placeholder="35">
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">性別</label>
            <select name="sex" class="form-select">
              <option value="">--</option>
              <option value="female">female</option>
              <option value="male">male</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-4">
            <label class="form-label">地域</label>
            <input type="text" name="region" class="form-control" placeholder="東京">
          </div>
          <div class="col-12">
            <label class="form-label">主訴（いちばん困っていること）</label>
            <textarea name="chief_complaint" class="form-control" rows="2" placeholder="例）雨の日に喉が詰まった感じがする / 肉を食べると15分後に下痢…など"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- 初心者モード -->
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>初心者モード（症状チェック → 自動判定）</strong>
        <button type="button" class="btn btn-sm btn-outline-light" onclick="applyBeginnerMapping()">反映する</button>
      </div>
      <div class="card-body">
        <div class="row">

          <!-- 寒熱 -->
          <div class="col-md-4 mb-3">
            <div class="fw-bold mb-2">寒・熱</div>
            <div class="small hint mb-1">左のチェックに基づき <u>寒/中庸/熱</u> を自動選択</div>
            <div class="d-flex">
              <div class="me-3">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="c_cold"><label class="form-check-label" for="c_cold">冷え</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="c_chills"><label class="form-check-label" for="c_chills">悪寒</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="c_warm_relief"><label class="form-check-label" for="c_warm_relief">温めると楽</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="c_loose"><label class="form-check-label" for="c_loose">下痢気味</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="c_clear_urine"><label class="form-check-label" for="c_clear_urine">尿が透明</label></div>
              </div>
              <div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="h_hotflash"><label class="form-check-label" for="h_hotflash">ほてり</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="h_thirst"><label class="form-check-label" for="h_thirst">口渇</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="h_nightsweat"><label class="form-check-label" for="h_nightsweat">寝汗</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="h_constip"><label class="form-check-label" for="h_constip">便秘ぎみ</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="h_yellow_urine"><label class="form-check-label" for="h_yellow_urine">黄色尿</label></div>
              </div>
            </div>
          </div>

          <!-- 実虚 -->
          <div class="col-md-4 mb-3">
            <div class="fw-bold mb-2">実・虚</div>
            <div class="small hint mb-1">チェックで <u>実/中間/虚</u> を自動選択</div>
            <div class="d-flex">
              <div class="me-3">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="v_fatigue"><label class="form-check-label" for="v_fatigue">だるい・疲れやすい</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="v_sob"><label class="form-check-label" for="v_sob">息切れ</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="v_smallvoice"><label class="form-check-label" for="v_smallvoice">声が小さい</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="v_postprandial_sleepy"><label class="form-check-label" for="v_postprandial_sleepy">食後に眠い</label></div>
              </div>
              <div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="j_stabbing_pain"><label class="form-check-label" for="j_stabbing_pain">刺す痛み</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="j_distention"><label class="form-check-label" for="j_distention">張る/詰まる</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="j_loudsnore"><label class="form-check-label" for="j_loudsnore">いびき・噛みしめ</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="j_constip"><label class="form-check-label" for="j_constip">便秘</label></div>
              </div>
            </div>
          </div>

          <!-- 気血水 -->
          <div class="col-md-4 mb-3">
            <div class="fw-bold mb-2">気血水（代表サイン）</div>
            <div class="small hint mb-1">チェックに応じて <u>気/血/水</u> ラジオを自動選択</div>
            <div class="row">
              <div class="col-12 mb-1"><span class="badge bg-secondary">気</span></div>
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="qi_def"><label class="form-check-label" for="qi_def">気虚：だるい/息切れ/食後眠い</label></div>
              </div>
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="qi_stag"><label class="form-check-label" for="qi_stag">気滞：張る/ため息/ストレスで悪化</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="qi_rev"><label class="form-check-label" for="qi_rev">気逆：げっぷ/胸やけ/のぼせ</label></div>
              </div>

              <div class="col-12 mt-2 mb-1"><span class="badge bg-secondary">血</span></div>
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="xue_def"><label class="form-check-label" for="xue_def">血虚：乾燥/めまい/不眠</label></div>
              </div>
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="xue_stasis"><label class="form-check-label" for="xue_stasis">瘀血：刺す痛み/しこり/暗紫舌</label></div>
              </div>

              <div class="col-12 mt-2 mb-1"><span class="badge bg-secondary">水</span></div>
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="sui_ret"><label class="form-check-label" for="sui_ret">水滞/痰湿：むくみ/頭重/雨天で悪化</label></div>
              </div>
              <div class="col-6">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="sui_def"><label class="form-check-label" for="sui_def">津液不足：口・皮膚乾燥/便秘傾向</label></div>
              </div>
            </div>
          </div>

        </div>

        <div class="text-end">
          <button type="button" class="btn btn-primary" onclick="applyBeginnerMapping()">↑ チェック内容をフォームに反映</button>
        </div>
      </div>
    </div>

    <!-- 体質（正式入力） -->
    <div class="card mb-4">
      <div class="card-header fw-bold">体質（八綱＋気血水）</div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-6 col-md-3">
            <label class="form-label">実/虚</label>
            <select name="jitsu_kyo" class="form-select">
              <option value="chukan">中間</option>
              <option value="jitsu">実</option>
              <option value="kyo">虚</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">寒/熱</label>
            <select name="kan_netsu" class="form-select">
              <option value="neutral">中庸</option>
              <option value="kan">寒</option>
              <option value="netsu">熱</option>
            </select>
          </div>

          <div class="col-12"></div>

          <div class="col-md-4">
            <div class="fw-bold mb-1">気</div>
            <div class="form-check"><input class="form-check-input" type="radio" name="qi" id="qi_n" value="normal" checked><label class="form-check-label" for="qi_n">正常</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="qi" id="qi_d" value="deficiency"><label class="form-check-label" for="qi_d">気虚</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="qi" id="qi_s" value="stagnation"><label class="form-check-label" for="qi_s">気滞</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="qi" id="qi_r" value="rebellion"><label class="form-check-label" for="qi_r">気逆</label></div>
          </div>
          <div class="col-md-4">
            <div class="fw-bold mb-1">血</div>
            <div class="form-check"><input class="form-check-input" type="radio" name="xue" id="xue_n" value="normal" checked><label class="form-check-label" for="xue_n">正常</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="xue" id="xue_d" value="deficiency"><label class="form-check-label" for="xue_d">血虚</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="xue" id="xue_s" value="stasis"><label class="form-check-label" for="xue_s">瘀血</label></div>
          </div>
          <div class="col-md-4">
            <div class="fw-bold mb-1">水</div>
            <div class="form-check"><input class="form-check-input" type="radio" name="sui" id="sui_n" value="normal" checked><label class="form-check-label" for="sui_n">正常</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="sui" id="sui_r" value="retention"><label class="form-check-label" for="sui_r">水滞/痰湿</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="sui" id="sui_d2" value="deficiency"><label class="form-check-label" for="sui_d2">津液不足</label></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 視診（任意） -->
    <div class="card mb-4">
      <div class="card-header fw-bold">視診（任意）</div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-6 col-md-3">
            <label class="form-label">脈の力</label>
            <select name="pulse_strength" class="form-select">
              <option value="">--</option>
              <option value="weak">弱い</option>
              <option value="normal">普通</option>
              <option value="strong">強い</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">脈の速さ</label>
            <select name="pulse_rate" class="form-select">
              <option value="">--</option>
              <option value="slow">遅い</option>
              <option value="normal">普通</option>
              <option value="rapid">速い</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">脈の性状</label>
            <select name="pulse_quality" class="form-select">
              <option value="">--</option>
              <option value="wiry">弦</option>
              <option value="slippery">滑</option>
              <option value="choppy">渋</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">顔色</label>
            <select name="face_color" class="form-select">
              <option value="">--</option>
              <option value="pale">青白い</option>
              <option value="normal">普通</option>
              <option value="red">赤み</option>
            </select>
          </div>

          <div class="col-sm-6 col-md-3">
            <label class="form-label">舌の色</label>
            <select name="tongue_color" class="form-select">
              <option value="">--</option>
              <option value="pale">淡</option>
              <option value="red">紅</option>
              <option value="purple">紫</option>
              <option value="normal">正常</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">舌の体</label>
            <select name="tongue_body" class="form-select">
              <option value="">--</option>
              <option value="scalloped">歯痕</option>
              <option value="swollen">腫大</option>
              <option value="thin">瘦薄</option>
              <option value="normal">正常</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">舌苔</label>
            <select name="tongue_coat" class="form-select">
              <option value="">--</option>
              <option value="thin_white">薄白</option>
              <option value="thick_white">厚白</option>
              <option value="yellow">黄苔</option>
              <option value="none">なし</option>
            </select>
          </div>
          <div class="col-sm-6 col-md-3">
            <label class="form-label">舌の湿</label>
            <select name="tongue_moisture" class="form-select">
              <option value="">--</option>
              <option value="dry">乾</option>
              <option value="normal">普通</option>
              <option value="wet">湿</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- 画像アップ -->
    <div class="card mb-4">
      <div class="card-header fw-bold">画像アップロード（任意・複数可）</div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">舌</label>
            <input type="file" name="tongue_images" class="form-control" accept="image/*" multiple>
          </div>
          <div class="col-md-3">
            <label class="form-label">顔</label>
            <input type="file" name="face_images" class="form-control" accept="image/*" multiple>
          </div>
          <div class="col-md-3">
            <label class="form-label">体・むくみ</label>
            <input type="file" name="body_images" class="form-control" accept="image/*" multiple>
          </div>
          <div class="col-md-3">
            <label class="form-label">爪</label>
            <input type="file" name="nails_images" class="form-control" accept="image/*" multiple>
          </div>
        </div>
      </div>
    </div>

    <!-- 右ガイド＋送信 -->
    <div class="row g-4">
      <div class="col-lg-8">
        <button class="btn btn-primary btn-lg w-100" type="submit">この内容で判定する</button>
      </div>
      <div class="col-lg-4">
        <div class="card" id="miniGuide">
          <div class="card-header fw-bold">初心者ミニガイド</div>
          <div class="card-body small">
            <div class="mb-2">● <b>虚</b>：だるい・声小・息切れ → 補う処方を検討</div>
            <div class="mb-2">● <b>実</b>：張る・詰まる・痛み強 → 巡らせて余分をさばく</div>
            <hr>
            <div class="mb-2">● <b>寒</b>：冷え/下痢/温め良 → 温中・温陽</div>
            <div class="mb-2">● <b>熱</b>：ほてり/口渇/便秘/黄苔 → 清熱・養陰</div>
            <hr>
            <div class="mb-2">● <b>気虚</b>：だるい/息切れ/食後眠い</div>
            <div class="mb-2">● <b>気滞</b>：張る/ため息/ストレスで悪化</div>
            <div class="mb-2">● <b>血虚</b>：乾燥/めまい/不眠（女性は月経量少）</div>
            <div class="mb-2">● <b>瘀血</b>：刺す痛み/しこり/暗紫舌</div>
            <div class="mb-2">● <b>水滞</b>：むくみ/頭重/雨天で悪化・軟便</div>
            <div class="mb-2">● <b>津液不足</b>：口・皮膚乾燥/便秘傾向</div>
            <hr>
            <div>● 主訴を拾う質問例：</div>
            <ul class="mt-2">
              <li>いつ・どんな状況で悪化しますか？（雨/食後/冷飲後…）</li>
              <li>痛みの性質は？（刺す/鈍い/張る…）</li>
              <li>冷え/ほてり/口渇/汗/便の傾向は？</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </form>
</div>

<script>
function setSelectValue(name, value) {
  const el = document.querySelector(`[name="${name}"]`);
  if (el) el.value = value;
}
function setRadio(name, value) {
  const el = document.querySelector(`[name="${name}"][value="${value}"]`);
  if (el) el.checked = true;
}
function applyBeginnerMapping() {
  // 寒熱
  let heat = 0, cold = 0;
  ['h_hotflash','h_thirst','h_nightsweat','h_constip','h_yellow_urine'].forEach(id=>{
    if (document.getElementById(id).checked) heat++;
  });
  ['c_cold','c_chills','c_warm_relief','c_loose','c_clear_urine'].forEach(id=>{
    if (document.getElementById(id).checked) cold++;
  });
  if (heat - cold >= 2) setSelectValue('kan_netsu', 'netsu');
  else if (cold - heat >= 2) setSelectValue('kan_netsu', 'kan');
  else setSelectValue('kan_netsu', 'neutral');

  // 実虚
  let jitsu = 0, kyo = 0;
  ['j_stabbing_pain','j_distention','j_loudsnore','j_constip'].forEach(id=>{
    if (document.getElementById(id).checked) jitsu++;
  });
  ['v_fatigue','v_sob','v_smallvoice','v_postprandial_sleepy'].forEach(id=>{
    if (document.getElementById(id).checked) kyo++;
  });
  if (jitsu - kyo >= 2) setSelectValue('jitsu_kyo', 'jitsu');
  else if (kyo - jitsu >= 2) setSelectValue('jitsu_kyo', 'kyo');
  else setSelectValue('jitsu_kyo', 'chukan');

  // 気血水
  if (document.getElementById('qi_def').checked) setRadio('qi','deficiency');
  if (document.getElementById('qi_stag').checked) setRadio('qi','stagnation');
  if (document.getElementById('qi_rev').checked) setRadio('qi','rebellion');

  if (document.getElementById('xue_def').checked) setRadio('xue','deficiency');
  if (document.getElementById('xue_stasis').checked) setRadio('xue','stasis');

  if (document.getElementById('sui_ret').checked) setRadio('sui','retention');
  if (document.getElementById('sui_def').checked) setRadio('sui','deficiency');

  alert('チェック内容をフォームに反映しました。必要なら微調整してください。');
}
</script>
</body>
</html>
