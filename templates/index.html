<!doctype html><html lang="ja"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>漢方AI問診 v8（主訴直結型）</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;margin:16px;line-height:1.6}
.section{border:1px solid #ddd;border-radius:10px;padding:14px;margin:14px 0;background:#fff}
.grid2{display:grid;grid-template-columns:1.2fr 0.8fr;gap:14px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.row{display:flex;gap:8px;margin:6px 0;align-items:flex-start}
.row input[type=checkbox]{width:20px;height:20px;margin-top:2px}
input,select,textarea{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
label{display:block}
button{padding:12px 16px;border:none;border-radius:10px;background:#2a6;color:#fff}
.pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#f5f5f5;margin:2px 6px 2px 0;font-size:13px}
.hint{font-size:13px;color:#555}
@media (max-width:900px){.grid2{grid-template-columns:1fr} .grid{grid-template-columns:1fr} button{width:100%}}
</style></head><body>
<h1>漢方AI問診 v8（主訴直結型）</h1>

<details class="section" open>
  <summary><strong>初心者薬剤師向けガイド</strong></summary>
  <ul class="hint">
    <li><b>必ず聞く：</b> 始まり/経過、冷え/ほてり、食欲・もたれ・便通、睡眠、（女性のみ）月経、ストレス/運動/飲酒</li>
    <li><b>視る：</b> 顔色、舌（色/体/苔/湿）、脈（力/速/性状）</li>
    <li><b>危険サイン：</b> 激痛・高熱・胸痛・血便・黒色便 など → 医療機関へ</li>
  </ul>
</details>

<form action="/submit" method="post" enctype="multipart/form-data" onsubmit="syncHidden();">
<div class="grid2">
  <div>
    <div class="section">
      <h3>基本情報</h3>
      <div class="grid">
        <div><label>氏名<input name="name" required></label></div>
        <div><label>年齢<input type="number" name="age" min="0" max="120"></label></div>
        <div><label>性別<select name="sex"><option value="">未選択</option><option value="female">女性</option><option value="male">男性</option><option value="other">その他</option></select></label></div>
        <div><label>地域<input name="region"></label></div>
      </div>
      <label>主訴（そのままでOK）<textarea name="chief_complaint" rows="2" placeholder="例：肉を食べると15分で下痢／雨の日に頭が痛い…など"></textarea></label>
    </div>

    <div class="section">
      <h3>チェックリスト（左で選択）</h3>
      <div class="grid">
        <div>
          <h4>実・虚</h4>
          <div class="row"><input type="checkbox" class="v-flag" data-type="kyo" id="v1"><label for="v1">休むと楽/声小さい/自汗/食後眠い/脈弱/舌淡・歯痕（虚+1）</label></div>
          <div class="row"><input type="checkbox" class="v-flag" data-type="jitsu" id="v2"><label for="v2">張りが強い/便秘/怒りっぽい/肩こり強/脈実/舌暗紫（実+1）</label></div>
          <h4>寒・熱</h4>
          <div class="row"><input type="checkbox" class="c-flag" data-type="kan" id="c1"><label for="c1">冷える・温めて楽/冷飲苦手/薄白苔（寒+1）</label></div>
          <div class="row"><input type="checkbox" class="c-flag" data-type="netsu" id="c2"><label for="c2">ほてり・口渇/寝汗/黄苔/顔赤（熱+1）</label></div>
          <h4>表・裏</h4>
          <div class="row"><input type="checkbox" class="b-flag" data-type="hyo" id="b1"><label for="b1">悪寒発熱・項背こわばり（表+1）</label></div>
          <div class="row"><input type="checkbox" class="b-flag" data-type="ri" id="b2"><label for="b2">胃腸/慢性/深部の冷えや痛み（裏+1）</label></div>
        </div>
        <div>
          <h4>気・血・水</h4>
          <div class="row"><input type="checkbox" class="q-flag" data-type="deficiency" id="q1"><label for="q1">だるい・息切れ・食後眠い（気虚+1）</label></div>
          <div class="row"><input type="checkbox" class="q-flag" data-type="stagnation" id="q2"><label for="q2">張る・ため息・ストレスで悪化（気滞+1）</label></div>
          <div class="row"><input type="checkbox" class="q-flag" data-type="rebellion" id="q3"><label for="q3">のぼせ・げっぷ・逆流（気逆+1）</label></div>
          <div class="row"><input type="checkbox" class="x-flag" data-type="deficiency" id="x1"><label for="x1">乾燥・不眠・めまい（女性：月経量少）（血虚+1）</label></div>
          <div class="row"><input type="checkbox" class="x-flag" data-type="stasis" id="x2"><label for="x2">刺す固定痛（女性：月経痛・塊）（瘀血+1）</label></div>
          <div class="row"><input type="checkbox" class="s-flag" data-type="retention" id="s1"><label for="s1">むくみ・頭重・雨で悪化・軟便（痰湿+1）</label></div>
          <div class="row"><input type="checkbox" class="s-flag" data-type="deficiency" id="s2"><label for="s2">口乾/皮膚乾燥/便秘傾向（津液不足+1）</label></div>
        </div>
      </div>

      <div style="margin-top:8px">
        <span class="pill" id="badge-jk">実虚：—</span>
        <span class="pill" id="badge-cn">寒熱：—</span>
        <span class="pill" id="badge-br">表裏：—</span>
        <span class="pill" id="badge-qi">気：—</span>
        <span class="pill" id="badge-xue">血：—</span>
        <span class="pill" id="badge-sui">水：—</span>
      </div>
    </div>

    <div class="section">
      <h3>視診（任意）</h3>
      <div class="grid">
        <div>
          <h4>脈</h4>
          <label>力<select name="pulse_strength"><option value="">未選択</option><option value="strong">強</option><option value="normal">平</option><option value="weak">弱</option></select></label>
          <label>速さ<select name="pulse_rate"><option value="">未選択</option><option value="rapid">速い（数）</option><option value="normal">普通</option><option value="slow">遅い（遅）</option></select></label>
          <label>性状<select name="pulse_quality"><option value="">未選択</option><option value="wiry">弦</option><option value="slippery">滑</option><option value="rough">渋</option><option value="none">特になし</option></select></label>
        </div>
        <div>
          <h4>顔色</h4>
          <label>顔色<select name="face_color"><option value="">未選択</option><option value="pale">蒼白</option><option value="red">紅</option><option value="sallow">黄</option><option value="dark">暗</option></select></label>
        </div>
      </div>
      <h4>舌</h4>
      <div class="grid">
        <div><label>色<select name="tongue_color"><option value="">未選択</option><option value="pale">淡</option><option value="light_red">淡紅</option><option value="red">紅</option><option value="dark_purple">暗紫</option></select></label></div>
        <div><label>体<select name="tongue_body"><option value="">未選択</option><option value="thin">薄</option><option value="swollen">腫大</option><option value="scalloped">歯痕</option><option value="normal">平</option></select></label></div>
        <div><label>苔<select name="tongue_coat"><option value="">未選択</option><option value="none">無苔</option><option value="thin_white">薄白</option><option value="thick_white">厚白</option><option value="yellow">黄苔</option><option value="gray_black">灰黒</option></select></label></div>
        <div><label>湿<select name="tongue_moisture"><option value="">未選択</option><option value="dry">乾</option><option value="normal">平</option><option value="wet">湿</option></select></label></div>
      </div>
      <label>舌の写真<input type="file" name="tongue_images" accept="image/*" multiple></label>
      <label>顔写真<input type="file" name="face_images" accept="image/*" multiple></label>
      <label>体・むくみ写真<input type="file" name="body_images" accept="image/*" multiple></label>
      <label>爪の写真<input type="file" name="nails_images" accept="image/*" multiple></label>
    </div>

    <input type="hidden" name="jitsu_kyo" id="jitsu_kyo">
    <input type="hidden" name="kan_netsu" id="kan_netsu">
    <input type="hidden" name="hyo_ri" id="hyo_ri">
    <input type="hidden" name="qi" id="qi">
    <input type="hidden" name="xue" id="xue">
    <input type="hidden" name="sui" id="sui">

    <div class="section"><button type="submit">AI判定を表示（方剤1種＋主訴別アドバイス）</button></div>
  </div>

  <div class="section">
    <h3>今の判定</h3>
    <div><span class="pill" id="b1">実虚：—</span></div>
    <div><span class="pill" id="b2">寒熱：—</span></div>
    <div><span class="pill" id="b3">表裏：—</span></div>
    <div><span class="pill" id="b4">気：—</span></div>
    <div><span class="pill" id="b5">血：—</span></div>
    <div><span class="pill" id="b6">水：—</span></div>
    <p class="hint">※ バッジはチェックに応じて自動更新します</p>
  </div>
</div>
</form>

<script>
const st={kyo:0,jitsu:0,kan:0,netsu:0,hyo:0,ri:0,qi:{deficiency:0,stagnation:0,rebellion:0},xue:{deficiency:0,stasis:0},sui:{retention:0,deficiency:0}};
function upd(){
  let jk='chukan'; if(st.kyo>=2&&st.jitsu<=1)jk='kyo'; else if(st.jitsu>=2&&st.kyo<=1)jk='jitsu';
  let cn='neutral'; if(st.kan>=2)cn='kan'; else if(st.netsu>=2)cn='netsu';
  let br='unknown'; if(st.hyo>=2)br='hyo'; else if(st.ri>=2)br='ri';
  let q='normal',mx=-1; for(const k in st.qi){if(st.qi[k]>mx){mx=st.qi[k]; q=k;}} if(mx<=0)q='normal';
  let x='normal'; mx=-1; for(const k in st.xue){if(st.xue[k]>mx){mx=st.xue[k]; x=k;}} if(mx<=0)x='normal';
  let s='normal'; mx=-1; for(const k in st.sui){if(st.sui[k]>mx){mx=st.sui[k]; s=k;}} if(mx<=0)s='normal';
  document.getElementById('b1').textContent='実虚：'+(jk==='kyo'?'虚証':jk==='jitsu'?'実証':'中間証');
  document.getElementById('b2').textContent='寒熱：'+(cn==='kan'?'寒':cn==='netsu'?'熱':'不明');
  document.getElementById('b3').textContent='表裏：'+(br==='hyo'?'表':br==='ri'?'裏':'不明');
  document.getElementById('b4').textContent='気：'+(q==='deficiency'?'気虚':q==='stagnation'?'気滞':q==='rebellion'?'気逆':'正常');
  document.getElementById('b5').textContent='血：'+(x==='deficiency'?'血虚':x==='stasis'?'瘀血':'正常');
  document.getElementById('b6').textContent='水：'+(s==='retention'?'水滞/痰湿':s==='deficiency'?'津液不足':'正常');
  document.getElementById('jitsu_kyo').value=jk; document.getElementById('kan_netsu').value=cn; document.getElementById('hyo_ri').value=br;
  document.getElementById('qi').value=q; document.getElementById('xue').value=x; document.getElementById('sui').value=s;
}
document.querySelectorAll('.v-flag').forEach(e=>e.addEventListener('change',ev=>{st[ev.target.dataset.type]+=ev.target.checked?1:-1;upd();}));
document.querySelectorAll('.c-flag').forEach(e=>e.addEventListener('change',ev=>{st[ev.target.dataset.type]+=ev.target.checked?1:-1;upd();}));
document.querySelectorAll('.b-flag').forEach(e=>e.addEventListener('change',ev=>{st[ev.target.dataset.type]+=ev.target.checked?1:-1;upd();}));
document.querySelectorAll('.q-flag').forEach(e=>e.addEventListener('change',ev=>{st.qi[ev.target.dataset.type]+=ev.target.checked?1:-1;upd();}));
document.querySelectorAll('.x-flag').forEach(e=>e.addEventListener('change',ev=>{st.xue[ev.target.dataset.type]+=ev.target.checked?1:-1;upd();}));
document.querySelectorAll('.s-flag').forEach(e=>e.addEventListener('change',ev=>{st.sui[ev.target.dataset.type]+=ev.target.checked?1:-1;upd();}));
function syncHidden(){upd();}
upd();
</script>
</body></html>
