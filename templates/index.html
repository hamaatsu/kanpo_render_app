<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ q.title or "AI漢方・問診票" }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body { max-width: 960px; margin: 24px auto; padding: 0 12px; }
    h1 { margin-bottom: 16px; }
    .section { border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px; margin: 16px 0; background:#fff; }
    .q { margin: 12px 0; }
    .q label { display: block; font-weight: 600; margin-bottom: 6px; }
    .help { color:#6b7280; font-size: 0.9em; }
    .row { display:flex; flex-wrap: wrap; gap: 12px; }
    .chip { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid #d1d5db; border-radius:10px; margin:4px 8px 4px 0; }
    input[type="text"], input[type="number"], select, textarea {
      width: 100%; max-width: 480px; padding: 8px; border: 1px solid #d1d5db; border-radius: 8px;
    }
    textarea { min-height: 96px; }
    .submit { margin-top: 20px; }
    button { background:#2563eb; color:white; border:none; border-radius:10px; padding:12px 20px; font-weight:700; cursor:pointer; }
    button:hover { background:#1e40af; }
  </style>
</head>
<body>
  <h1>{{ q.title or "AI漢方・問診票" }}</h1>

  <form method="post" action="{{ url_for('submit') }}">
    {% for sec in q.sections %}
      <div class="section">
        <h2>{{ sec.title }}</h2>

        {% for qu in sec.questions %}
          <div class="q">
            {% set qid = qu.id %}
            {% set typ = qu.type %}
            {% set placeholder = qu.placeholder or "" %}

            {% if typ == "text" %}
              <label for="{{ qid }}">{{ qu.label }}</label>
              <input id="{{ qid }}" name="{{ qid }}" type="text" placeholder="{{ placeholder }}"/>

            {% elif typ == "number" %}
              <label for="{{ qid }}">{{ qu.label }}</label>
              <input id="{{ qid }}" name="{{ qid }}" type="number" placeholder="{{ placeholder }}" inputmode="numeric"/>

            {% elif typ == "textarea" %}
              <label for="{{ qid }}">{{ qu.label }}</label>
              <textarea id="{{ qid }}" name="{{ qid }}" placeholder="{{ placeholder }}"></textarea>

            {% elif typ == "select" %}
              <label for="{{ qid }}">{{ qu.label }}</label>
              <select id="{{ qid }}" name="{{ qid }}">
                {% for opt in qu.options %}
                  <option value="{{ opt }}">{{ opt }}</option>
                {% endfor %}
              </select>

            {% elif typ == "boolean" %}
              <label>
                <input type="checkbox" name="{{ qid }}" />
                {{ qu.label }}
              </label>

            {% elif typ == "checkboxes" %}
              <label>{{ qu.label }}</label>
              <div class="row">
                {% for opt in qu.options %}
                  <label class="chip">
                    <input type="checkbox" name="{{ qid }}" value="{{ opt }}">
                    <span>{{ opt }}</span>
                  </label>
                {% endfor %}
              </div>

            {% else %}
              <!-- 未対応タイプはテキストでフォールバック -->
              <label for="{{ qid }}">{{ qu.label }}</label>
              <input id="{{ qid }}" name="{{ qid }}" type="text" placeholder="{{ placeholder }}"/>
            {% endif %}

            {% if qu.help %}
              <div class="help">{{ qu.help }}</div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}

    <div class="submit">
      <button type="submit">AIに送信して判定する</button>
    </div>
  </form>
</body>
</html>