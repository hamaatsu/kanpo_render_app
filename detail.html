<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>解析結果</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header>
    <h1>解析結果</h1>
  </header>

  <main>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flash">
          {% for cat, msg in messages %}
            <li class="{{cat}}">{{ msg }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    {% if raw_output %}
      <section>
        <h2>AI生出力（JSON解析不可）</h2>
        <pre>{{ raw_output }}</pre>
      </section>
    {% endif %}

    {% if result %}
      <section>
        <h2>基本判定</h2>
        <ul>
          <li><strong>主症状：</strong>{{ result.main_symptom }}</li>
          <li><strong>急性/慢性：</strong>{{ result.acute_or_chronic }}</li>
          <li><strong>気血水：</strong>{{ result.kiketsusui | join("・") }}</li>
          <li><strong>八綱分類：</strong>{{ result.hakkou.label }}（表裏：{{ result.hakkou.hyou_ura }} ／ 寒熱：{{ result.hakkou.kan_netsu }} ／ 虚実：{{ result.hakkou.kyo_jitsu }}）</li>
        </ul>
      </section>

      <section>
        <h2>漢方薬候補（3件）</h2>
        <ol>
          {% for k in result.kampo_candidates %}
          <li>
            <strong>{{ k.name }}</strong><br>
            <span class="small">根拠：</span>{{ k.rationale }}
          </li>
          {% endfor %}
        </ol>
      </section>

      <section>
        <h2>1剤に絞る薬剤師へのアドバイス</h2>
        <p>{{ result.pharmacist_selection_advice }}</p>
      </section>

      <section>
        <h2>薬膳材料（5つ）</h2>
        <ul class="grid2">
          {% for y in result.yakuzen_ingredients %}
          <li>{{ y.name }}<span class="small">（{{ y.effect }}）</span></li>
          {% endfor %}
        </ul>
      </section>

      <section>
        <h2>主症状へのアドバイス</h2>
        <p>{{ result.advice_for_main_symptom }}</p>
      </section>

      <section>
        <h2>生活上のアドバイス</h2>
        <p>{{ result.lifestyle_advice }}</p>
      </section>

      {% if result.safety_notes %}
      <section>
        <h2>安全上の注意</h2>
        <p class="warn">{{ result.safety_notes }}</p>
      </section>
      {% endif %}

      <section>
        <h2>信頼度</h2>
        <p>AIの自己評価：{{ "%.2f"|format(result.confidence) }}</p>
      </section>
    {% endif %}

    <div class="actions">
      <a class="btn" href="/">入力に戻る</a>
    </div>
  </main>
</body>
</html>
